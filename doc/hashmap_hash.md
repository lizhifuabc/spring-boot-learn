# 前言

基于 jdk8

# 基础知识

- 异或^：

  相同则为0，不相同为1

- 位与 &：

  有0则为0
  (1&1=1 1&0=0 0&0=0)

# hash算法

目的：通过hash算法将key映射成整数, 再将整数映射成数组的下标index。

源码：

```java
    static final int hash(Object key) {
        int h;
        return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
    }
```

解析：

- HashMap中key值可以为null, 且null值一定存储在数组的第一个位置。
- 扰动函数：hashCode的高16位和低16位进行异或, 这充分利用了高半位和低半位的信息, 而且混合后的低位掺杂了高位的部分特征，这样高位的信息也被变相保留下来。

# 延伸

HashMap的数组长度要取2的整次幂：

因为这样（数组长度-1）正好相当于一个低位掩码。“与”操作的结果就是散列值的高位全部归零。只保留低位值，用来做数组下标访问。

默认长度为16，此时16-1=15：

> 00000000 00000000 00000000 00010000(16)
>
> 00000000 00000000 00000000 00001111(15)

此时在数组存放元素时进行“与”操作：(table.length - 1) & key.hash

> ​		00000000 00000000 00000000 00001111(15)
>
> ​		00000000 00000000 00000110 00100011(14)
>
> &      ----------------------------------------------------------------------------------
>
> ​        00000000 00000000 00000000 000000011(数组index:3,高位全部归零，只保留末四位进行与运算)

