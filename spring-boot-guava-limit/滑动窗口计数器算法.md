# 升级

​	固定窗口可以对一段时间的流量就行监控，但是有一个致命的问题，就是我们监控流量都是指时间段而不是具体的某一个时间，假设我们的窗口时间为1分钟，当1分钟后会切换到另外一个窗口重新监控。这个切换就有可能出现问题。假设我们在第一个窗口的最后十秒发了100个请求，在第二个窗口开始的时候也可以发100个请求，那么在这二十秒时间内服务器就会接收到200个请求，这样很有可能会使服务器接收的请求过多而挂掉。所以就出现了固定窗口的优化版，滑动窗口来解决这个问题。

# 概念

固定窗口计数器算法的升级版。

- 把时间以一定比例分片：每分钟处理60个请求，我们可以把1分钟分为60个窗口。
- 每隔1秒移动一次，每个窗口一秒只能处理 <= (请求数)/窗口数)的请求。
- 如果当前窗口的请求计数总和超过了限制的数量的话就不再处理其他请求。

> 当滑动窗口的格子划分的越多，滑动窗口的滚动就越平滑，限流的统计就会越精确。
>
> 在每次有访问进来时，我们判断前N个单位时间内的总访问量是否超过了设置的阈值，并对当前时间片上的请求数+1。

